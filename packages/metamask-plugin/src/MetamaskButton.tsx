import React, { useEffect, useState } from 'react';
import { PluginElementContext } from '@burner-wallet/types';
import styled from 'styled-components';

const StyledButton = styled.button`
  height: 40px;
  margin: 0 auto;
  display: block;
  border: solid 1px #ccc;
  display: flex;
  align-items: center;
  border-radius: 20px;
  font-size: 14px;
  color: #666666;
  background: #fafafa;
  outline: none;

  &:hover {
    color: #333333;
  }

  &:hover:before {
    background-position: -31px 0;
  }

  &:before {
    content: '';
    background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MiIgaGVpZ2h0PSIxOSI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNLTEtMWgyMnYyMkgtMXoiLz48cGF0aCBmaWxsPSIjOTI5NDk4IiBkPSJNMTkuMjE0LjA0bC03Ljg4OCA1LjkyN0wxMi43OSAyLjQ3ek0xLjAyMi4wNGw3LjgxNyA1Ljk4M0w3LjQ0NSAyLjQ3eiIvPjxwYXRoIGZpbGw9IiM5MTkzOTciIGQ9Ik0xNi4zNzkgMTMuNzc5bC0yLjA5OSAzLjI1NiA0LjQ5IDEuMjUxIDEuMjg0LTQuNDM1ek0uMTkgMTMuODUxbDEuMjc1IDQuNDM1IDQuNDktMS4yNS0yLjA5LTMuMjU3eiIvPjxwYXRoIGZpbGw9IiM5Mjk0OTgiIGQ9Ik01LjcxIDguMjc3bC0xLjI1IDEuOTE3IDQuNDUxLjItLjE1LTQuODUyem04LjgxNSAwTDExLjQzIDUuNDg2bC0uMTAzIDQuOTA4IDQuNDUtLjJ6bS04LjU2OSA4Ljc1OGwyLjY4NS0xLjMyMy0yLjMxMy0xLjgyOXptNS42MzktMS4zMjNsMi42ODUgMS4zMjMtLjM3Mi0zLjE1MnoiLz48cGF0aCBkPSJNMTQuMjggMTcuMDM1bC0yLjY4NS0xLjMyMy4yMTQgMS43NzItLjAyNC43NDZ6bS04LjMyNCAwTDguNDUgMTguMjNsLS4wMTYtLjc0Ni4yMDYtMS43NzJ6IiBmaWxsPSIjQ0NDRUQyIi8+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTguNDk4IDEyLjcxMmwtMi4yMzMtLjY2NSAxLjU3Ni0uNzN6bTMuMjQgMGwuNjU3LTEuMzk1IDEuNTg0LjczeiIvPjxwYXRoIGQ9Ik01Ljk1NiAxNy4wMzVsLjM4OC0zLjI1Ni0yLjQ3OS4wNzJ6bTcuOTM2LTMuMjU2bC4zODggMy4yNTYgMi4wOTktMy4xODR6bTEuODg1LTMuNTg1bC00LjQ1MS4yLjQxMiAyLjMxOC42NTctMS4zOTUgMS41ODQuNzN6bS05LjUxMiAxLjg1M2wxLjU3Ni0uNzMuNjU3IDEuMzk1LjQxMi0yLjMxOC00LjQ1MS0uMnoiIGZpbGw9IiM3RjgxODUiLz48cGF0aCBmaWxsPSIjOTE5Mzk3IiBkPSJNNC40NTkgMTAuMTk0bDEuODcgMy42OS0uMDY0LTEuODM3em05LjUyIDEuODUzbC0uMDcxIDEuODM2IDEuODY5LTMuNjl6Ii8+PHBhdGggZmlsbD0iIzkwOTI5NiIgZD0iTTguOTEgMTAuMzk0bC0uNDEyIDIuMzE4LjUyMyAyLjczNS4xMS0zLjZ6bTIuNDE2IDBsLS4yMTQgMS40NDQuMTAzIDMuNjEuNTIzLTIuNzM2eiIvPjxwYXRoIGZpbGw9IiM5RDlGQTMiIGQ9Ik0xMS43MzggMTIuNzEybC0uNTIzIDIuNzM1LjM4LjI2NSAyLjMxMy0xLjgyOS4wNzEtMS44MzZ6bS01LjQ3My0uNjY1bC4wNjMgMS44MzYgMi4zMTMgMS44MjkuMzgtLjI2NS0uNTIzLTIuNzM1eiIvPjxwYXRoIGZpbGw9IiNCOUJCQkYiIGQ9Ik0xMS43ODUgMTguMjNsLjAyNC0uNzQ2LS4xOTgtLjE3Nkg4LjYyNWwtLjE5LjE3Ni4wMTYuNzQ2LTIuNDk1LTEuMTk1Ljg3MS43MjJMOC42MDEgMTloMy4wMzRsMS43NzQtMS4yNDMuODcxLS43MjJ6Ii8+PHBhdGggZmlsbD0iIzQ2NDY0NiIgZD0iTTExLjU5NSAxNS43MTJsLS4zOC0uMjY1SDkuMDJsLS4zOC4yNjUtLjIwNiAxLjc3Mi4xOS0uMTc2aDIuOTg2bC4xOTguMTc2eiIvPjxwYXRoIGQ9Ik0xOS41NDcgNi4zNTJsLjY2NS0zLjI3Mi0uOTk4LTMuMDQtNy42MTkgNS43MjcgMi45MyAyLjUxIDQuMTQzIDEuMjI3LjkxLTEuMDgzLS4zOTUtLjI4OC42MzMtLjU4Ni0uNDgzLS4zODUuNjM0LS40OXpNLjAyNCAzLjA4bC42NzMgMy4yNzItLjQyOC4zMi42MzQuNDktLjQ4My4zODUuNjMzLjU4Ni0uMzk2LjI4OC45MTEgMS4wODNMNS43MSA4LjI3N2wyLjkzLTIuNTFMMS4wMjMuMDR6IiBmaWxsPSIjNTA1MjU2Ii8+PHBhdGggZmlsbD0iIzlEOUZBMyIgZD0iTTE4LjY2OCA5LjUwNGwtNC4xNDMtMS4yMjcgMS4yNTIgMS45MTctMS44NyAzLjY5IDIuNDcyLS4wMzNoMy42NzV6TTUuNzEgOC4yNzdMMS41NjggOS41MDQuMTkgMTMuODUxaDMuNjc1bDIuNDYzLjAzMi0xLjg2OS0zLjY5eiIvPjxwYXRoIGZpbGw9IiM5RUEwQTQiIGQ9Ik0xMS4zMjYgMTAuMzk0bC4yNjktNC42MjcgMS4xOTYtMy4yOTdINy40NDVMOC42NCA1Ljc2N2wuMjcgNC42MjcuMTAyIDEuNDYuMDA4IDMuNTkzaDIuMTk0bC4wMDgtMy41OTN6Ii8+PHBhdGggZmlsbD0iI0Y3N0IwMCIgZD0iTTUwLjI5OC4wNGwtNy45MjMgNS45MjUgMS40NzItMy40OTZ6bS0xOC4yNzIgMGw3Ljg1MSA1Ljk4LTEuNC0zLjU1eiIvPjxwYXRoIGZpbGw9IiNGODdCMDAiIGQ9Ik00Ny40NSAxMy43NzNsLTIuMTA4IDMuMjU1IDQuNTEgMS4yNSAxLjI4OS00LjQzM3ptLTE2LjI2LjA3MmwxLjI4MiA0LjQzMyA0LjUxLTEuMjUtMi4xLTMuMjU1eiIvPjxwYXRoIGZpbGw9IiNGNzdEMDAiIGQ9Ik0zNi43MzUgOC4yNzNsLTEuMjU3IDEuOTE2IDQuNDcuMi0uMTUtNC44NXptOC44NTQgMGwtMy4xMS0yLjc5LS4xMDQgNC45MDcgNC40Ny0uMnoiLz48cGF0aCBmaWxsPSIjRjc3QjAwIiBkPSJNMzYuOTgyIDE3LjAyOGwyLjY5Ni0xLjMyMy0yLjMyMi0xLjgyOHptNS42NjMtMS4zMjNsMi42OTcgMS4zMjMtLjM3NC0zLjE1eiIvPjxwYXRoIGQ9Ik00NS4zNDIgMTcuMDI4bC0yLjY5Ny0xLjMyMy4yMTUgMS43NzItLjAyNC43NDV6bS04LjM2IDBsMi41MDUgMS4xOTQtLjAxNS0uNzQ1LjIwNi0xLjc3MnoiIGZpbGw9IiNERkM3QkEiLz48cGF0aCBmaWxsPSIjRkZGIiBkPSJNMzkuNTM1IDEyLjcwN2wtMi4yNDMtLjY2NiAxLjU4My0uNzN6bTMuMjU0IDBsLjY2LTEuMzk1IDEuNTkuNzN6Ii8+PHBhdGggZmlsbD0iI0UzNjcwMCIgZD0iTTM2Ljk4MiAxNy4wMjhsLjM5LTMuMjU1LTIuNDkuMDcyem03Ljk3LTMuMjU1bC4zOSAzLjI1NSAyLjEwOC0zLjE4M3oiLz48cGF0aCBmaWxsPSIjRTI2NjAwIiBkPSJNNDYuODQ1IDEwLjE5bC00LjQ3LjIuNDE0IDIuMzE3LjY2LTEuMzk1IDEuNTkuNzN6bS05LjU1MyAxLjg1MWwxLjU4My0uNzMuNjYgMS4zOTYuNDE0LTIuMzE3LTQuNDctLjJ6Ii8+PHBhdGggZD0iTTM1LjQ3OCAxMC4xOWwxLjg3OCAzLjY4Ny0uMDY0LTEuODM2em05LjU2MiAxLjg1MWwtLjA3MiAxLjgzNiAxLjg3Ny0zLjY4OHptLTUuMDkxLTEuNjUxbC0uNDE0IDIuMzE3LjUyNSAyLjczNC4xMTItMy42em0yLjQyNiAwbC0uMjE1IDEuNDQzLjEwNCAzLjYwOC41MjUtMi43MzR6IiBmaWxsPSIjRjg3QjAwIi8+PHBhdGggZmlsbD0iI0ZGOEMwMCIgZD0iTTQyLjc4OSAxMi43MDdsLS41MjUgMi43MzQuMzgxLjI2NCAyLjMyMy0xLjgyOC4wNzItMS44MzZ6bS01LjQ5Ny0uNjY2bC4wNjQgMS44MzYgMi4zMjIgMS44MjguMzgyLS4yNjQtLjUyNS0yLjczNHoiLz48cGF0aCBmaWxsPSIjQ0RCNUE3IiBkPSJNNDIuODM2IDE4LjIyMmwuMDI0LS43NDUtLjE5OS0uMTc3aC0yLjk5OGwtLjE5MS4xNzcuMDE2Ljc0NS0yLjUwNi0xLjE5NC44NzUuNzIxIDEuNzgyIDEuMjQzaDMuMDQ2bDEuNzgyLTEuMjQzLjg3NS0uNzIxeiIvPjxwYXRoIGZpbGw9IiMxODE4MTgiIGQ9Ik00Mi42NDUgMTUuNzA1bC0uMzgxLS4yNjRINDAuMDZsLS4zODIuMjY0LS4yMDYgMS43NzIuMTktLjE3N2gzbC4xOTguMTc3eiIvPjxwYXRoIGQ9Ik01MC42MzIgNi4zNWwuNjY4LTMuMjcyTDUwLjI5OC4wNGwtNy42NTMgNS43MjQgMi45NDQgMi41MSA0LjE2IDEuMjI2LjkxNS0xLjA4Mi0uMzk4LS4yODkuNjM2LS41ODUtLjQ4NS0uMzg1LjYzNi0uNDg5ek0zMS4wMjQgMy4wNzhMMzEuNyA2LjM1bC0uNDMuMzIxLjYzNy40OS0uNDg1LjM4NC42MzYuNTg1LS4zOTguMjg5LjkxNSAxLjA4MiA0LjE2LTEuMjI3IDIuOTQzLTIuNTA5TDMyLjAyNi4wNHoiIGZpbGw9IiM4QjQ0MDIiLz48cGF0aCBmaWxsPSIjRkY4RDAwIiBkPSJNNDkuNzQ5IDkuNWwtNC4xNi0xLjIyNyAxLjI1NiAxLjkxNi0xLjg3NyAzLjY4OCAyLjQ4Mi0uMDMyaDMuNjl6TTM2LjczNSA4LjI3M0wzMi41NzUgOS41bC0xLjM4NCA0LjM0NWgzLjY5bDIuNDc1LjAzMi0xLjg3OC0zLjY4OHoiLz48cGF0aCBmaWxsPSIjRkY4QzAwIiBkPSJNNDIuMzc1IDEwLjM5bC4yNy00LjYyNiAxLjIwMi0zLjI5NWgtNS4zN2wxLjIwMSAzLjI5NS4yNyA0LjYyNi4xMDQgMS40NTkuMDA4IDMuNTkyaDIuMjA0bC4wMDgtMy41OTJ6Ii8+PC9nPjwvc3ZnPg==');
    background-repeat: no-repeat;
    width: 20px;
    height: 20px;
    display: inline-block;
    margin: 4px;
  }
`;


const MetamaskButton: React.FC<PluginElementContext> = ({ actions, accounts }) => {
  const [showBtn, setShowBtn] = useState(false);

  useEffect(() => {
    setShowBtn(actions.canCallSigner('enable', 'injected'));
  }, [accounts]);

  if (!showBtn) {
    return null;
  }

  const enable = async () => {
    await actions.callSigner('enable', 'injected');
    setShowBtn(actions.canCallSigner('enable', 'injected'));
  }

  return (
    <div>
      <StyledButton onClick={enable}>Enable Metamask</StyledButton>
    </div>
  );
};

export default MetamaskButton;
